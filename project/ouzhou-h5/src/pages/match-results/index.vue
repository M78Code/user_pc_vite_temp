<template>
    <scroll-list menu_type="28" :is_show_badge="false" :current_mi="state.current_mi" :menuList="state.slideMenu_sport" @changeMenu="changeMenu"/>
    <div class="match-result">
        <date-tab v-if="state.slideMenu" :defaultVal="state.currentSlideValue"  :dateList="state.slideMenu" @changeDate="changeDate"/>
        <match-container />
    </div>

</template>
<script setup>
import lodash_ from 'lodash'
import { watch,onMounted, onBeforeMount, reactive,ref,nextTick } from "vue";
import MatchMeta from "src/core/match-list-h5/match-class/match-meta.js";
import setectLeague from 'src/base-h5/components/setect-league/index.vue'
import { scrollMenuEvent } from "src/base-h5/components/menu/app-h5-menu/utils.js"
import matchContainer from "src/base-h5/components/match-list/index.vue";
import { i18n_t, compute_css_obj, MenuData } from "src/core/index.js";
import VirtualList from 'src/core/match-list-h5/match-class/virtual-list'
import scrollList from 'src/base-h5/components/top-menu/top-menu-ouzhou-1/scroll-menu/scroll-list.vue';
import dateTab from 'src/base-h5/components/top-menu/top-menu-ouzhou-1/date-tab/date-tab.vue';
import { api_analysis } from "src/api/"

const inner_height = window.innerHeight;  // 视口高度
const props = defineProps({})
const state = reactive({
    select_dialog:false,
    currentSlideValue:"",
    slideMenu:[],
    slideMenu_sport: [], // 赛种
})
const selectFinishHandle = (val) => {
    console.log('选择完成')
    state.select_dialog = false
}
/**
 * 时间点击
 * @param {*} item 
 */
const changeDate = (item) =>{
    if (state.currentSlideValue === item.val) return
    state.currentSlideValue = item.val
     getData(state.slideMenu_sport.filter((n)=>{return n.mi === state.current_mi})[0],item.val)
}
/**
 * 球种点击
 * @param {*} item 
 */
const changeMenu = (item) =>{
    if (state.current_mi === item.mi) return
    state.current_mi = item.mi;
    state.slideMenu = item.subList;
    state.currentSlideValue = lodash_.get(item.subList,'[0].field1', '');
    getData( item,lodash_.get(item.subList,'[0].field1', ''));
}
/**
 * 初始化数据
 * @param {*} scroll_data 
 */
const init_data = (scroll_data) =>{
    state.slideMenu_sport = scroll_data;
    state.current_mi = scroll_data[0].mi
    state.slideMenu = scroll_data[0].subList
    state.currentSlideValue = lodash_.get(scroll_data[0].subList,'[0].field1', '')
    getData( scroll_data[0],lodash_.get(scroll_data[0].subList,'[0].field1', ''))
}
const switchHandle = async ()=> {
    const res = await  api_analysis.get_result_menu();
    //获取 赛果菜单
    // api_analysis.get_match_result_menu( {menuType:0} ).then( ( res = {} ) => {
        if(res?.code == 200){
            let scroll_data = res.data.filter((n)=>{return n.sportId != '0'}).map( item => {
                // <100常规 >3000电竞  vr不处理 冠军400
                const mi = item.menuType<100?100+item.sportId*1 + '':item.menuType>3000?`${'2'}${item.sportId}`:item.menuType==100?400:item.sportId
                return {
                    mi: mi,
                    ct: item.count,
                    sport: item.sportId,
                    name:item.name,
                    subList:item.subList.map((n)=>{
                        return {
                            val:n.field1,
                            ...n
                        }
                    })
                }
            })
            MenuData.set_slideMenu_sport(scroll_data);
            !MenuData.slideMenu_sport?.length && init_data(scroll_data)
        }
    // })
}
/**
 * 请求
 * @param {*} item 
 * @param {*} date 
 */
const getData = (item,date) =>{
    let params = {
        mi:item.mi,
        md:date,
        sport:item.sport
    }
    MenuData.set_result_menu_api_params(params)
    MatchMeta.get_results_match()
}
onMounted(()=>{
    VirtualList.set_is_show_ball(false)
    MenuData.set_current_lv1_menu(28)
    MenuData.slideMenu_sport?.length && init_data(MenuData.slideMenu_sport);//优先取缓存
    switchHandle();//正常加载接口  替换新数据
})

</script>
<style scoped lang="scss">
@import "./index.scss";
.match-result{
    // height: calc(100% - 1.73rem);
    height: 0;
    flex: 1;
    overflow: hidden;
    overflow-y: auto;
    .match-list-container{
        height: calc(100% - 45px);
    }
}
</style>
